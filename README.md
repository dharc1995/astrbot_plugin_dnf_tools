# DNF工具插件 (astrbot_plugin_dnf_tools)

一个为AstrBot设计的DNF游戏工具插件，提供幸运频道查询功能。

## 功能特性

- **幸运频道查询**: 根据用户QQ号和当前日期计算今日的幸运频道
- **每日固定结果**: 同一用户在同一天获得相同结果
- **北京时间支持**: 使用UTC+8时区，遵循DNF游戏6:00刷新规则
- **可配置**: 支持通过配置文件自定义省份、频道和频道名称映射

## 安装

1. 将插件文件夹放置到AstrBot的插件目录：`data/plugins/`
2. 重启AstrBot或重新加载插件

## 使用方法

### 基本命令

- `/幸运频道` - 查询今日的幸运频道

### 示例

```
用户: /幸运频道
机器人: [用户名], 你今天（2026/1/22-6:00~2026/1/23-5:59）的幸运频道是 301（贝尔玛尔公国）！
```

## 配置说明

配置文件位于 `lucky_channel/config.json`，包含以下字段：

```json
{
    "province": [3, 7, 11, 14, 16, 20, 21, 29, 30, 36, 41, 44, 53, 55, 58, 62],
    "channel": [20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32],
    "channel_map": {
        "20": "贝尔玛尔公国",
        "21": "第七帝国",
        "22": "魔界",
        "23": "瓦哈伊特",
        "24": "白海",
        "25": "重力之泉",
        "26": "重力之泉",
        "27": "重力之泉",
        "28": "重力之泉",
        "29": "重力之泉",
        "30": "重力之泉",
        "31": "重力之泉",
        "32": "重力之泉"
    }
}
```

### 字段说明

- `province`: 省份代码列表，用于生成幸运频道的前缀
- `channel`: 频道代码列表，用于生成幸运频道的后缀
- `channel_map`: 频道代码到频道名称的映射关系

## 开发说明

### 项目结构

```
astrbot_plugin_dnf_tools/
├── main.py              # 插件主文件
├── metadata.yaml        # 插件元数据
├── README.md           # 说明文档
├── LICENSE             # 许可证文件
└── lucky_channel/      # 幸运频道模块
    ├── lucky.py        # 幸运频道计算逻辑
    └── config.json     # 配置文件
```

### 代码质量特性

- **类型提示**: 使用Python类型提示提高代码可读性和可维护性
- **完整文档**: 所有公共方法和类都有详细的文档字符串
- **错误处理**: 完善的异常处理和用户友好的错误消息
- **代码规范**: 遵循PEP 8编码规范

## 技术实现

### 幸运频道算法

1. **时间计算**: 使用北京时间(UTC+8)，遵循DNF游戏6:00刷新规则
2. **随机种子**: 使用`QQ号_YYYYMMDD`作为随机种子，确保每日结果固定
3. **随机选择**: 从配置的省份和频道列表中随机选择
4. **结果格式化**: 生成格式化的消息返回给用户

### 错误处理

插件包含多层错误处理：
- 配置文件不存在时的友好提示
- JSON格式错误的详细报告
- 未知异常的捕获和日志记录

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 支持与反馈

- 项目地址: [https://github.com/dharc1995/astrbot_plugin_dnf_tools](https://github.com/dharc1995/astrbot_plugin_dnf_tools)
- AstrBot帮助文档: [https://astrbot.app](https://astrbot.app)

## 版本历史

- v0.3.4: 改进代码质量和文档，添加类型提示和完整文档
- v0.3.1: 初始版本，实现基本幸运频道功能
